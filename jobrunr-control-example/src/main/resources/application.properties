# =============================================================================
# HTTP Configuration
# https://quarkus.io/guides/http-reference
# =============================================================================
# Increased to handle large form submissions with multiple job parameters (default: 2KB)
quarkus.http.limits.max-form-attribute-size=10M
quarkus.http.port=9090
# =============================================================================
# Security / OIDC Configuration
# https://quarkus.io/guides/security-oidc-code-flow-authentication
# https://quarkus.io/guides/security-oidc-bearer-token-authentication#integration-with-authorization-code-flow
# =============================================================================
# Default OIDC tenant for web UI (authorization code flow)
quarkus.oidc.auth-server-url=http://localhost:8080/realms/jobrunr
quarkus.oidc.client-id=jobrunr-control
quarkus.oidc.credentials.secret=jobrunr-secret
quarkus.oidc.application-type=web-app
# API tenant for bearer token authentication (REST API calls)
# This allows both browser-based UI (web-app) and API calls with bearer tokens
quarkus.oidc.api.auth-server-url=http://localhost:8080/realms/jobrunr
quarkus.oidc.api.client-id=jobrunr-control
quarkus.oidc.api.credentials.secret=jobrunr-secret
quarkus.oidc.api.application-type=service
# API tenant only validates bearer tokens, doesn't redirect to login
quarkus.oidc.api.authentication.force-redirect-https-scheme=false
# Keycloak DevServices Configuration for Dev Mode
# Automatically starts a Keycloak Testcontainer with custom realm using Podman.
# --- Default dev: Testcontainer (Podman) ---
%dev.quarkus.keycloak.devservices.enabled=true
%dev.quarkus.keycloak.devservices.realm-path=keycloak-realm.json
%dev.quarkus.keycloak.devservices.show-logs=true
%dev.quarkus.keycloak.devservices.start-command=start-dev
# Use Podman as the container runtime for DevServices
%dev.quarkus.devservices.container-runtime=podman
# Disable OIDC Dev UI to prevent hang during metadata discovery with Podman.
# The Dev UI tries to discover OIDC metadata before the Keycloak container is fully ready,
# causing the Quarkus Main Thread to block indefinitely.
%dev.quarkus.oidc.dev-ui.enabled=false
# Connection timeout to prevent hanging if Keycloak is not available (default: 10s)
quarkus.oidc.connection-timeout=5s
# Discovery timeout for OIDC metadata (prevents hanging on startup)
quarkus.oidc.discovery-enabled=true
quarkus.oidc.connection-delay=2s
# The DevServices container will automatically configure quarkus.oidc.auth-server-url
# --- keycloak profile: connect to external Keycloak (started via ./start-keycloak.sh) ---
# Activate with: ./mvnw -f jobrunr-control-example/pom.xml quarkus:dev -Dquarkus.profile=dev,keycloak
%keycloak.quarkus.keycloak.devservices.enabled=false
# Authentication policies - enforce login for all JobRunr Control paths.
# Quarkus uses "longest path wins"; the wildcard /q/jobrunr-control/* does NOT match
# the exact path /q/jobrunr-control (DashboardController root), so we list both.
quarkus.http.auth.permission.jobrunr-control.paths=/q/jobrunr-control,/q/jobrunr-control/*
quarkus.http.auth.permission.jobrunr-control.policy=authenticated
# JobRunr Control API - specific permissions for /api/* endpoints
# GET requests: allow api-reader, api-executor, viewer, configurator, admin
quarkus.http.auth.permission.jobrunr-control-api-read.paths=/q/jobrunr-control/api/*
quarkus.http.auth.permission.jobrunr-control-api-read.policy=api-reader-policy
quarkus.http.auth.permission.jobrunr-control-api-read.methods=GET,OPTIONS,HEAD
# POST/PUT/DELETE requests: allow api-executor, admin
quarkus.http.auth.permission.jobrunr-control-api-write.paths=/q/jobrunr-control/api/*
quarkus.http.auth.permission.jobrunr-control-api-write.policy=api-executor-policy
quarkus.http.auth.permission.jobrunr-control-api-write.methods=POST,PUT,DELETE,PATCH
# JobRunr Pro Dashboard: embedded mode does not support JobRunr's own OpenID auth
# (see https://www.jobrunr.io/en/guides/authentication/openid-authentication/).
# Protect it via Quarkus OIDC instead.
quarkus.http.auth.permission.jobrunr-dashboard.paths=/q/jobrunr,/q/jobrunr/*
quarkus.http.auth.permission.jobrunr-dashboard.policy=authenticated
# Custom role-based policies for JobRunr API
# Admin policy: only users with the 'admin' realm role
quarkus.http.auth.policy.admin-policy.roles-allowed=admin
# Viewer policy: users with 'viewer', 'configurator', or 'admin' roles (read-only access)
quarkus.http.auth.policy.viewer-policy.roles-allowed=viewer,configurator,admin
# API executor policy: for service accounts (bearer tokens) with api-executor or admin roles
quarkus.http.auth.policy.api-executor-policy.roles-allowed=api-executor,admin
# API reader policy: for service accounts (bearer tokens) with api-reader, api-executor, or admin roles
quarkus.http.auth.policy.api-reader-policy.roles-allowed=api-reader,api-executor,admin
# JobRunr API endpoints: split by HTTP method
# Read-only methods (GET, OPTIONS, HEAD): accessible by viewer, configurator, and admin
quarkus.http.auth.permission.jobrunr-api-read.paths=/q/jobrunr/api/*
quarkus.http.auth.permission.jobrunr-api-read.policy=viewer-policy
quarkus.http.auth.permission.jobrunr-api-read.methods=GET,OPTIONS,HEAD
# Write methods (POST, PUT, DELETE, PATCH): only accessible by admin
quarkus.http.auth.permission.jobrunr-api-write.paths=/q/jobrunr/api/*
quarkus.http.auth.permission.jobrunr-api-write.policy=admin-policy
quarkus.http.auth.permission.jobrunr-api-write.methods=POST,PUT,DELETE,PATCH
# Role mapping - read realm roles from the Keycloak access token
quarkus.oidc.roles.source=accesstoken
quarkus.oidc.api.roles.source=accesstoken
# Automatically refresh expired ID tokens using the refresh token instead of throwing an error
quarkus.oidc.token.refresh-expired=true
# Logout: clears session and redirects to Keycloak end_session_endpoint, then back to scheduled jobs
quarkus.oidc.logout.path=/q/jobrunr-control/logout
quarkus.oidc.logout.post-logout-path=/q/jobrunr-control/scheduled
# Token issuer is auto-configured by DevServices in dev mode, set explicitly in prod
# =============================================================================
# JobRunr Configuration
# https://www.jobrunr.io/en/documentation/configuration/quarkus/
# =============================================================================
quarkus.jobrunr.background-job-server.enabled=true
quarkus.jobrunr.background-job-server.worker-count=20
quarkus.jobrunr.job-scheduler.enabled=true
quarkus.jobrunr.jobs.metrics.enabled=true
quarkus.jobrunr.jobs.metrics.micrometer-timers.enabled=true
# =============================================================================
# JobRunr Dashboard
# type: 'embedded' (same port) | 'standalone' (separate port, default 8000)
# =============================================================================
quarkus.jobrunr.dashboard.enabled=true
quarkus.jobrunr.dashboard.type=embedded
quarkus.jobrunr.dashboard.context-path=/q/jobrunr
# =============================================================================
# Database Configuration
# https://quarkus.io/guides/datasource
# =============================================================================
# --- Dev: H2 in-memory (default, no setup required) ---
# The INIT script creates the jobrunr_control_parameter_sets table automatically.
# NOTE: H2 must run in standard mode (not Oracle mode) because JobRunr generates H2-specific SQL.
%dev.quarkus.datasource.db-kind=h2
%dev.quarkus.datasource.username=sa
%dev.quarkus.datasource.password=
%dev.quarkus.datasource.jdbc.url=jdbc:h2:mem:devdb;DB_CLOSE_DELAY=-1;INIT=RUNSCRIPT FROM 'classpath:db/h2.sql'
%dev.quarkus.datasource.jdbc.max-size=16
# --- PostgreSQL profile ---
# Activate with: ./mvnw quarkus:dev -Dquarkus.profile=dev,postgres
# Run ./start-postgres.sh first to start PostgreSQL and create the required table.
%postgres.quarkus.datasource.db-kind=postgresql
%postgres.quarkus.datasource.username=postgres
%postgres.quarkus.datasource.password=your_strong_password
%postgres.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/postgres
%postgres.quarkus.datasource.jdbc.max-size=16
# --- Oracle profile ---
# Activate with: ./mvnw quarkus:dev -Dquarkus.profile=dev,oracle
# Run ./start-oracle.sh first to start Oracle and create the required table.
%oracle.quarkus.datasource.db-kind=oracle
%oracle.quarkus.datasource.username=system
%oracle.quarkus.datasource.password=YourStrongPassword123
%oracle.quarkus.datasource.jdbc.url=jdbc:oracle:thin:@localhost:1521/FREEPDB1
%oracle.quarkus.datasource.jdbc.max-size=16
# --- Production ---
# Configure via environment variables at runtime. Example:
#   QUARKUS_DATASOURCE_DB_KIND=postgresql
#   QUARKUS_DATASOURCE_USERNAME=prod_user
#   QUARKUS_DATASOURCE_PASSWORD=prod_password
#   QUARKUS_DATASOURCE_JDBC_URL=jdbc:postgresql://prod-server:5432/jobrunr_db
# Dummy build-time values below are overridden at runtime.
%prod.quarkus.datasource.db-kind=postgresql
%prod.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/postgres
# =============================================================================
# Hibernate ORM Configuration (only needed with @JobParameterSet external storage)
# https://quarkus.io/guides/hibernate-orm
# Add quarkus-hibernate-orm to your pom.xml and configure:
#   quarkus.hibernate-orm.schema-management.strategy=none
# Schema must be created manually ? see SQL scripts in docs/sql/.
# =============================================================================
# =============================================================================
# Logging Configuration
# https://quarkus.io/guides/logging
# =============================================================================
quarkus.log.category."ch.css.jobrunr".level=INFO
quarkus.log.category."org.jobrunr".level=INFO
# =============================================================================
# OpenAPI / Swagger UI
# =============================================================================
mp.openapi.extensions.smallrye.info.title=JobRunr Control API
mp.openapi.extensions.smallrye.info.version=1.0.0
mp.openapi.extensions.smallrye.info.description=REST API for JobRunr Pro Scheduler Extension
mp.openapi.extensions.smallrye.info.contact.name=JobRunr Control Team
# =============================================================================
# Development Profile Settings
# =============================================================================
# Dev mode uses a Keycloak Testcontainer (via Podman) by default.
#
# To use an external Keycloak instead (start via ./start-keycloak.sh):
#   ./mvnw -f jobrunr-control-example/pom.xml quarkus:dev -Dquarkus.profile=dev,keycloak
#
# --- no-oidc profile: Testing without authentication (dev/test only) ---
# Activate with: ./mvnw -f jobrunr-control-example/pom.xml quarkus:dev -Dquarkus.profile=no-oidc
# WARNING: Disables all authentication! Use ONLY for development and testing.
%no-oidc.quarkus.oidc.enabled=false
%no-oidc.quarkus.http.auth.permission.jobrunr-control.policy=permit
%no-oidc.quarkus.http.auth.permission.jobrunr-dashboard.policy=permit
%no-oidc.quarkus.http.auth.permission.jobrunr-api-read.policy=permit
%no-oidc.quarkus.http.auth.permission.jobrunr-api-write.policy=permit
%no-oidc.quarkus.log.category."ch.css.jobrunr.control.security".level=WARN
